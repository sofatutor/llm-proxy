{{ define "tokens/show.html" }}
{{ template "layout/start" . }}

<div class="row">
    <div class="col-12">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h1>
                <i class="bi bi-key"></i>
                Token Details
            </h1>
            <div>
                <a href="/tokens" class="btn btn-outline-secondary">
                    <i class="bi bi-arrow-left"></i>
                    Back to Tokens
                </a>
            </div>
        </div>
    </div>
    </div>

    {{ if .token }}
    <div class="row">
        <div class="col-md-8">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0">Token</h5>
                </div>
                <div class="card-body">
                    <div class="row mb-3">
                        <div class="col-sm-4"><strong>Token ID</strong></div>
                        <div class="col-sm-8">
                            <code>{{ .token.ID }}</code>
                            <button class="btn btn-sm btn-outline-secondary ms-2" 
                                    onclick="copyToClipboard('{{ .token.ID }}')" 
                                    title="Copy token ID to clipboard">
                                <i class="bi bi-clipboard"></i>
                            </button>
                        </div>
                    </div>
                    <div class="row mb-3">
                        <div class="col-sm-4"><strong>Token (obfuscated)</strong></div>
                        <div class="col-sm-8">
                            <code>{{ .token.Token }}</code>
                        </div>
                    </div>
                    <div class="row mb-3">
                        <div class="col-sm-4"><strong>Project</strong></div>
                        <div class="col-sm-8">
                            <a href="/projects/{{ .project.ID }}" class="text-decoration-none">
                                {{ .project.Name }}
                            </a>
                            <br>
                            <small class="text-muted">{{ .project.ID }}</small>
                        </div>
                    </div>
                    <div class="row mb-3">
                        <div class="col-sm-4"><strong>Status</strong></div>
                        <div class="col-sm-8">
                            {{ if .token.IsActive }}
                                {{ if .token.ExpiresAt }}
                                    {{ if gt .token.ExpiresAt.Unix now.Unix }}
                                        <span class="badge bg-success">
                                            <i class="bi bi-check-circle"></i>
                                            Active
                                        </span>
                                    {{ else }}
                                        <span class="badge bg-danger">
                                            <i class="bi bi-x-circle"></i>
                                            Expired
                                        </span>
                                    {{ end }}
                                {{ else }}
                                    <span class="badge bg-success">
                                        <i class="bi bi-check-circle"></i>
                                        Active
                                    </span>
                                {{ end }}
                            {{ else }}
                                <span class="badge bg-danger">
                                    <i class="bi bi-x-circle"></i>
                                    Inactive
                                </span>
                            {{ end }}
                        </div>
                    </div>
                    <div class="row mb-3">
                        <div class="col-sm-4"><strong>Expires</strong></div>
                        <div class="col-sm-8">
                            {{ if .token.ExpiresAt }}
                                <span data-local-time="true" data-ts="{{ formatRFC3339UTC .token.ExpiresAt }}" data-format="long" title="{{ formatRFC3339UTC .token.ExpiresAt }}">{{ .token.ExpiresAt.Format "Monday, January 2, 2006 15:04" }}</span>
                            {{ else }}
                                <span class="text-muted">Never expires</span>
                            {{ end }}
                        </div>
                    </div>
                    <div class="row mb-3">
                        <div class="col-sm-4"><strong>Usage</strong></div>
                        <div class="col-sm-8">
                            <strong>{{ .token.RequestCount }}</strong> requests made
                            {{ if .token.MaxRequests }}
                                <br>
                                <small class="text-muted">Limit: {{ .token.MaxRequests }} requests</small>
                            {{ else }}
                                <br>
                                <small class="text-muted">No limit</small>
                            {{ end }}
                        </div>
                    </div>
                    <div class="row mb-3">
                        <div class="col-sm-4"><strong>Created</strong></div>
                        <div class="col-sm-8">
                            <span data-local-time="true" data-ts="{{ formatRFC3339UTC .token.CreatedAt }}" data-format="long" title="{{ formatRFC3339UTC .token.CreatedAt }}">{{ .token.CreatedAt.Format "Monday, January 2, 2006 15:04" }}</span>
                        </div>
                    </div>
                    {{ if .token.LastUsedAt }}
                    <div class="row mb-3">
                        <div class="col-sm-4"><strong>Last Used</strong></div>
                        <div class="col-sm-8">
                            <span data-local-time="true" data-ts="{{ formatRFC3339UTC .token.LastUsedAt }}" data-format="long" title="{{ formatRFC3339UTC .token.LastUsedAt }}">{{ .token.LastUsedAt.Format "Monday, January 2, 2006 15:04" }}</span>
                        </div>
                    </div>
                    {{ end }}
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0">Actions</h5>
                </div>
                <div class="card-body d-grid gap-2">
                    <a href="/tokens/{{ .token.ID }}/edit" class="btn btn-outline-warning">
                        <i class="bi bi-pencil"></i>
                        Edit Token
                    </a>
                    {{ if .token.ExpiresAt }}
                        {{ if .token.ExpiresAt.Before .currentTime }}
                        <!-- Token is expired - no actions available -->
                        <button type="button" class="btn btn-outline-secondary" disabled title="Token is expired">
                            <i class="bi bi-clock-history"></i>
                            Expired - No Actions Available
                        </button>
                        {{ else if .token.IsActive }}
                        <!-- Token is active - show revoke button -->
                        <button type="button" class="btn btn-outline-danger" 
                                onclick="revokeToken('{{ .token.ID }}', '{{ .token.Token }}')">
                            <i class="bi bi-x-circle"></i>
                            Revoke Token
                        </button>
                        {{ else }}
                        <!-- Token is inactive but not expired - show reactivate button -->
                        <button type="button" class="btn btn-outline-success" 
                                onclick="reactivateToken('{{ .token.ID }}', '{{ .token.Token }}')">
                            <i class="bi bi-arrow-clockwise"></i>
                            Reactivate Token
                        </button>
                        {{ end }}
                    {{ else if .token.IsActive }}
                        <!-- No expiry set and active -->
                        <button type="button" class="btn btn-outline-danger" 
                                onclick="revokeToken('{{ .token.ID }}', '{{ .token.Token }}')">
                            <i class="bi bi-x-circle"></i>
                            Revoke Token
                        </button>
                    {{ else }}
                        <!-- No expiry set and inactive -->
                        <button type="button" class="btn btn-outline-success" 
                                onclick="reactivateToken('{{ .token.ID }}', '{{ .token.Token }}')">
                            <i class="bi bi-arrow-clockwise"></i>
                            Reactivate Token
                        </button>
                    {{ end }}
                    <hr>
                    <a href="/projects/{{ .project.ID }}" class="btn btn-outline-primary">
                        <i class="bi bi-folder"></i>
                        View Project
                    </a>
                    <a href="/tokens/new?project_id={{ .project.ID }}" class="btn btn-outline-success">
                        <i class="bi bi-key"></i>
                        Generate New Token
                    </a>
                </div>
            </div>
        </div>
    </div>
    {{ else }}
    <div class="alert alert-warning">
        Token not found.
    </div>
    {{ end }}

<script src="/static/js/token-utils.js"></script>
{{ template "layout/end" . }}
{{ end }}



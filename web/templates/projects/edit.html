{{ define "projects/edit.html" }}
{{ template "layout/start" . }}
<div class="row">
    <div class="col-12">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h1>
                <i class="bi bi-pencil"></i>
                Edit Project
            </h1>
            <div class="btn-group">
                <a href="/projects/{{ .project.ID }}" class="btn btn-outline-secondary">
                    <i class="bi bi-arrow-left"></i>
                    Back to Project
                </a>
                <a href="/projects" class="btn btn-outline-secondary">
                    <i class="bi bi-list"></i>
                    All Projects
                </a>
            </div>
        </div>
    </div>
</div>

<div class="row justify-content-center">
    <div class="col-md-8">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">Project Details</h5>
            </div>
            <div class="card-body">
                <form method="POST" action="/projects/{{ .project.ID }}">
                    <input type="hidden" name="_method" value="PUT">
                    
                    <div class="mb-3">
                        <label for="name" class="form-label">
                            Project Name <span class="text-danger">*</span>
                        </label>
                        <input type="text" 
                               class="form-control" 
                               id="name" 
                               name="name" 
                               required 
                               placeholder="Enter project name"
                               value="{{ .project.Name }}">
                        <div class="form-text">
                            Choose a descriptive name for your project.
                        </div>
                    </div>

                    <div class="mb-3">
                        <label for="openai_api_key" class="form-label">
                            OpenAI API Key <span class="text-muted">(optional)</span>
                        </label>
                        <div class="input-group">
                            <input type="password" 
                                   class="form-control" 
                                   id="openai_api_key" 
                                   name="openai_api_key" 
                                   placeholder="sk-... (leave empty to keep existing)"
                                   value="">
                            <button class="btn btn-outline-secondary" 
                                    type="button" 
                                    onclick="togglePassword('openai_api_key')">
                                <i class="bi bi-eye" id="openai_api_key_icon"></i>
                            </button>
                        </div>
                        <div class="form-text">
                            <i class="bi bi-shield-lock"></i>
                            Leave empty to keep the existing API key. Only enter a new key if you want to update it.
                            <a href="https://platform.openai.com/api-keys" target="_blank" class="text-decoration-none">
                                Get your API key here <i class="bi bi-box-arrow-up-right"></i>
                            </a>
                        </div>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Project Status</label>
                        <div class="form-check form-switch">
                            <!-- Hidden field to ensure false value is sent when checkbox is unchecked -->
                            <input type="hidden" name="is_active" value="false">
                            <input class="form-check-input" 
                                   type="checkbox" 
                                   id="is_active" 
                                   name="is_active" 
                                   value="true"
                                   {{ if .project.IsActive }}checked{{ end }}>
                            <label class="form-check-label" for="is_active">
                                Active
                            </label>
                        </div>
                        <div class="form-text">
                            When inactive, all tokens for this project will be disabled and API requests will be rejected.
                        </div>
                    </div>

                    <div class="card bg-light">
                        <div class="card-body">
                            <h6 class="card-title">
                                <i class="bi bi-info-circle"></i>
                                Project Information
                            </h6>
                            <div class="row">
                                <div class="col-sm-6">
                                    <strong>Project ID:</strong><br>
                                    <code class="small">{{ .project.ID }}</code>
                                </div>
                                <div class="col-sm-6">
                                    <strong>Created:</strong><br>
                                    <small class="text-muted"><span data-local-time="true" data-ts="{{ formatRFC3339UTC .project.CreatedAt }}" data-format="ymd_hm" title="{{ formatRFC3339UTC .project.CreatedAt }}">{{ .project.CreatedAt.UTC.Format "2006-01-02 15:04 UTC" }}</span></small>
                                </div>
                            </div>
                        </div>
                    </div>

                    <hr class="my-4">

                    <div class="d-flex justify-content-between">
                        <a href="/projects/{{ .project.ID }}" class="btn btn-secondary">
                            <i class="bi bi-x-circle"></i>
                            Cancel
                        </a>
                        <button type="submit" class="btn btn-primary">
                            <i class="bi bi-check-circle"></i>
                            Update Project
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Project Security Info -->
        <div class="card mt-4 border-info">
            <div class="card-header bg-info text-white">
                <h5 class="card-title mb-0">
                    <i class="bi bi-shield-check"></i>
                    Security & Audit
                </h5>
            </div>
            <div class="card-body">
                <p class="text-muted">
                    <i class="bi bi-info-circle"></i>
                    Projects cannot be deleted for security and audit compliance. 
                    To disable a project, uncheck "Active" above to revoke all tokens.
                </p>
                <a href="/tokens?project_id={{ .project.ID }}" class="btn btn-outline-primary">
                    <i class="bi bi-list"></i>
                    Manage Project Tokens
                </a>
            </div>
        </div>
    </div>
</div>

<!-- Delete functionality removed - projects cannot be deleted by design -->

<script>
function togglePassword(fieldId) {
    const field = document.getElementById(fieldId);
    const icon = document.getElementById(fieldId + '_icon');
    
    if (field.type === 'password') {
        field.type = 'text';
        icon.className = 'bi bi-eye-slash';
    } else {
        field.type = 'password';
        icon.className = 'bi bi-eye';
    }
}

// confirmDelete function removed - projects cannot be deleted by design
</script>
{{ template "layout/end" . }}
{{ end }}